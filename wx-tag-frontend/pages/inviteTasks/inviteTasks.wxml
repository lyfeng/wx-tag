<!--pages/inviteTasks/inviteTasks.wxml-->
<view class="container">
  <view class="page-header">
    <view class="home-button" bindtap="goHome">
      <text class="home-icon">ğŸ </text>
    </view>
    <text class="header-title">æˆ‘çš„é‚€è¯·ä»»åŠ¡</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view class="content-area" wx:else>
    <!-- è¿›è¡Œä¸­çš„ä»»åŠ¡ -->
    <block wx:if="{{activeTasks.length > 0}}">
      <view class="section-title">è¿›è¡Œä¸­çš„ä»»åŠ¡</view>
      <view class="task-card" wx:for="{{activeTasks}}" wx:key="taskId">
        <view class="task-header">
          <text class="task-title">æ ‡ç­¾æ”¶é›†ä»»åŠ¡ #{{item.taskNumber}}</text>
          <text class="task-status status-active">è¿›è¡Œä¸­</text>
        </view>
        <view class="task-body">
          <view class="task-detail">
            <text class="task-detail-label">å‘èµ·æ—¶é—´</text>
            <text>{{item.startTime}}</text>
          </view>
          <view class="task-detail">
            <text class="task-detail-label">å‰©ä½™æ—¶é—´</text>
            <text>{{item.remainingTime}}</text>
          </view>
          <view class="task-detail">
            <text class="task-detail-label">å·²æ”¶é›†</text>
            <text>{{item.participantCount}} äººå·²å‚ä¸</text>
          </view>
          <view class="task-detail">
            <text class="task-detail-label">ä»»åŠ¡è¿›åº¦</text>
            <text>å·²å®Œæˆ{{item.completedDays}}å¤©/å…±{{item.totalDays}}å¤©</text>
          </view>
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.progress}}%;"></view>
          </view>
        </view>
        <view class="task-footer">
          <view class="task-action" bindtap="continueInvite" data-task-id="{{item.taskId}}">ç»§ç»­é‚€è¯·</view>
          <view class="task-action action-primary" bindtap="viewTags" data-task-id="{{item.taskId}}">æŸ¥çœ‹æ ‡ç­¾</view>
        </view>
      </view>
    </block>

    <!-- å·²å®Œæˆçš„ä»»åŠ¡ -->
    <block wx:if="{{completedTasks.length > 0}}">
      <view class="section-title">å·²å®Œæˆçš„ä»»åŠ¡</view>
      <view class="task-card" wx:for="{{completedTasks}}" wx:key="taskId">
        <view class="task-header">
          <text class="task-title">æ ‡ç­¾æ”¶é›†ä»»åŠ¡ #{{item.taskNumber}}</text>
          <text class="task-status status-completed">å·²å®Œæˆ</text>
        </view>
        <view class="task-body">
          <view class="task-detail">
            <text class="task-detail-label">å‘èµ·æ—¶é—´</text>
            <text>{{item.startTime}}</text>
          </view>
          <view class="task-detail">
            <text class="task-detail-label">å®Œæˆæ—¶é—´</text>
            <text>{{item.endTime}}</text>
          </view>
          <view class="task-detail">
            <text class="task-detail-label">å‚ä¸äººæ•°</text>
            <text>{{item.participantCount}} äºº</text>
          </view>
          <view class="task-detail">
            <text class="task-detail-label">ä»»åŠ¡æ—¶é•¿</text>
            <text>{{item.totalDays}}å¤©</text>
          </view>
          <view class="progress-bar">
            <view class="progress-fill" style="width: 100%;"></view>
          </view>
        </view>
        <view class="task-footer">
          <view class="task-action">æ™ºèƒ½è¯„è¯­å·²ç”Ÿæˆ</view>
          <view class="task-action action-primary" bindtap="viewResult" data-task-id="{{item.taskId}}">æŸ¥çœ‹ç»“æœ</view>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && activeTasks.length === 0 && completedTasks.length === 0}}">
      <image src="/images/empty_task.png" mode="aspectFit" class="empty-image"></image>
      <text class="empty-text">è¿˜æ²¡æœ‰åˆ›å»ºè¿‡é‚€è¯·ä»»åŠ¡</text>
      <button class="create-task-btn" bindtap="createNewTask">åˆ›å»ºæ–°ä»»åŠ¡</button>
    </view>
  </view>

  <!-- åˆ†äº«å¼¹çª— -->
  <view class="modal" wx:if="{{isShowShareModal}}">
    <view class="modal-mask" bindtap="closeShareModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">é‚€è¯·å¥½å‹ç»™ä½ è´´æ ‡ç­¾</text>
        <image class="close-icon" src="/images/close.png" mode="aspectFit" bindtap="closeShareModal"></image>
      </view>
      <view class="modal-body">
        <text class="share-tip">é€‰æ‹©ä»¥ä¸‹æ–¹å¼åˆ†äº«ç»™å¥½å‹</text>
        <view class="share-buttons">
          <button class="share-btn" open-type="share">
            <image src="/images/wechat_share.png" mode="aspectFit"></image>
            <text>å¾®ä¿¡å¥½å‹</text>
          </button>
          <button class="share-btn" bindtap="copyInviteLink">
            <image src="/images/copy_link.png" mode="aspectFit"></image>
            <text>å¤åˆ¶é“¾æ¥</text>
          </button>
        </view>
      </view>
    </view>
  </view>
</view>